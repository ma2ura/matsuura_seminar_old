<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.280">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="松浦総一">

<title>ファイナンス入門</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
</style>


<script src="KM_Lecture_02_files/libs/clipboard/clipboard.min.js"></script>
<script src="KM_Lecture_02_files/libs/quarto-html/quarto.js"></script>
<script src="KM_Lecture_02_files/libs/quarto-html/popper.min.js"></script>
<script src="KM_Lecture_02_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="KM_Lecture_02_files/libs/quarto-html/anchor.min.js"></script>
<link href="KM_Lecture_02_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="KM_Lecture_02_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="KM_Lecture_02_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="KM_Lecture_02_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="KM_Lecture_02_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css">

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#第2章-ファイナンス入門" id="toc-第2章-ファイナンス入門" class="nav-link active" data-scroll-target="#第2章-ファイナンス入門">第2章 ファイナンス入門</a>
  <ul class="collapse">
  <li><a href="#割引率" id="toc-割引率" class="nav-link" data-scroll-target="#割引率">割引率</a>
  <ul class="collapse">
  <li><a href="#確実なキャッシュフローに対する割引率" id="toc-確実なキャッシュフローに対する割引率" class="nav-link" data-scroll-target="#確実なキャッシュフローに対する割引率">確実なキャッシュ・フローに対する割引率</a></li>
  <li><a href="#不確実なキャッシュフローに対する割引率" id="toc-不確実なキャッシュフローに対する割引率" class="nav-link" data-scroll-target="#不確実なキャッシュフローに対する割引率">不確実なキャッシュ・フローに対する割引率</a></li>
  <li><a href="#npv法" id="toc-npv法" class="nav-link" data-scroll-target="#npv法">NPV法</a></li>
  <li><a href="#配当割引モデル" id="toc-配当割引モデル" class="nav-link" data-scroll-target="#配当割引モデル">配当割引モデル</a></li>
  <li><a href="#ゴードン成長モデル" id="toc-ゴードン成長モデル" class="nav-link" data-scroll-target="#ゴードン成長モデル">ゴードン成長モデル</a></li>
  <li><a href="#割引率と期待リターンの関係" id="toc-割引率と期待リターンの関係" class="nav-link" data-scroll-target="#割引率と期待リターンの関係">割引率と期待リターンの関係</a></li>
  </ul></li>
  <li><a href="#平均分散アプローチ入門" id="toc-平均分散アプローチ入門" class="nav-link" data-scroll-target="#平均分散アプローチ入門">平均分散アプローチ入門</a>
  <ul class="collapse">
  <li><a href="#ポートフォリオのリスクとリターン" id="toc-ポートフォリオのリスクとリターン" class="nav-link" data-scroll-target="#ポートフォリオのリスクとリターン">ポートフォリオのリスクとリターン</a></li>
  <li><a href="#分散投資のメリット" id="toc-分散投資のメリット" class="nav-link" data-scroll-target="#分散投資のメリット">分散投資のメリット</a></li>
  <li><a href="#空売りの効果" id="toc-空売りの効果" class="nav-link" data-scroll-target="#空売りの効果">空売りの効果</a></li>
  <li><a href="#安全資産の導入" id="toc-安全資産の導入" class="nav-link" data-scroll-target="#安全資産の導入">安全資産の導入</a></li>
  <li><a href="#資産のポートフォリオ" id="toc-資産のポートフォリオ" class="nav-link" data-scroll-target="#資産のポートフォリオ">3資産のポートフォリオ</a></li>
  </ul></li>
  <li><a href="#最適ポートフォリオ問題" id="toc-最適ポートフォリオ問題" class="nav-link" data-scroll-target="#最適ポートフォリオ問題">最適ポートフォリオ問題</a>
  <ul class="collapse">
  <li><a href="#効率的フロンティア" id="toc-効率的フロンティア" class="nav-link" data-scroll-target="#効率的フロンティア">効率的フロンティア</a></li>
  <li><a href="#投資家のリスク回避度と最適ポートフォリオ" id="toc-投資家のリスク回避度と最適ポートフォリオ" class="nav-link" data-scroll-target="#投資家のリスク回避度と最適ポートフォリオ">投資家のリスク回避度と最適ポートフォリオ</a></li>
  <li><a href="#トービンの分離定理" id="toc-トービンの分離定理" class="nav-link" data-scroll-target="#トービンの分離定理">トービンの分離定理</a></li>
  </ul></li>
  <li><a href="#capm" id="toc-capm" class="nav-link" data-scroll-target="#capm">CAPM</a>
  <ul class="collapse">
  <li><a href="#仮定の確認" id="toc-仮定の確認" class="nav-link" data-scroll-target="#仮定の確認">仮定の確認</a></li>
  <li><a href="#capmの第一命題" id="toc-capmの第一命題" class="nav-link" data-scroll-target="#capmの第一命題">CAPMの第一命題</a></li>
  <li><a href="#capmの第二命題" id="toc-capmの第二命題" class="nav-link" data-scroll-target="#capmの第二命題">CAPMの第二命題</a></li>
  <li><a href="#証券市場線" id="toc-証券市場線" class="nav-link" data-scroll-target="#証券市場線">証券市場線</a></li>
  <li><a href="#n資産が投資可能な場合への拡張" id="toc-n資産が投資可能な場合への拡張" class="nav-link" data-scroll-target="#n資産が投資可能な場合への拡張">N資産が投資可能な場合への拡張</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">ファイナンス入門</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>松浦総一 </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<div class="cell">

</div>
<section id="第2章-ファイナンス入門" class="level1 page-columns page-full">
<h1>第2章 ファイナンス入門</h1>
<section id="割引率" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="割引率">割引率</h2>
<p>ファイナンスでは，ある財の今の価値と将来の価値は異なる，という考えをもっている。今の100万円と1年後の100万円の価値は異なるのである。 この現在の価値と未来の価値をつなぐ概念を<strong>割引率</strong>(discount rate)といい，将来キャッシュ・フローを<strong>現在価値</strong>(present value)に変換する際に用いる値である。 ファイナンス(finance)とは、この割引率がどのように決まるのかを明らかにする研究分野である。</p>
<section id="確実なキャッシュフローに対する割引率" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="確実なキャッシュフローに対する割引率">確実なキャッシュ・フローに対する割引率</h3>
<ul>
<li><strong>現在価値</strong> ：一般に将来発生するキャッシュフローの現時点における価値</li>
<li><strong>時間価値</strong> ：将来と現在の価値の違い</li>
<li><strong>無リスク金利</strong> (risk-free rate) ：安全資産(無リスク資産)へと投資したときのリターンであり，安全資産への投資時点でリターンとして獲得できる額が確定する。無リスク金利は<strong>確率変数ではなく定数</strong>(parameter)である。</li>
</ul>
<p><span class="math inline">T</span>年後の<strong>確実な</strong>キャッシュフローを<span class="math inline">CF_T</span>で表し，無リスク割引率を<span class="math inline">R_F</span>とすると，その現在価値は以下のように計算される。</p>
<p><span class="math display">
PV = \frac{CF_T}{(1 + R_F)^T}
</span></p>

<div class="no-row-height column-margin column-container"><div class="">
<p>現時点で<span class="math inline">CF_0</span>を1年間貯金する。利息<span class="math inline">r</span>は<span class="math inline">0.1</span>とする。 1年後に受け取れるキャッシュフロー<span class="math inline">CF_1</span>は、貯金した元本<span class="math inline">CF_0</span>と利息<span class="math inline">CF_0 \times 0.1</span>となる。つまり、<span class="math inline">CF_0 + CF_0 \times 0.1 = (1+0.1)CF_0</span>である。</p>
<p>逆に、来年<span class="math inline">CF_1</span>受け取るためには、今いくら貯金するかを考える。必要な貯金額を<span class="math inline">X</span>とすると、<span class="math inline">X \times (1 + 0.1) = CF_1</span>となる。つまり<span class="math inline">X = CF_1/ (1.1)</span>となる。 これが現在価値である。</p>
</div></div><p>将来の確実なキャッシュ・フロー<span class="math inline">CF_T</span>の現在価値は、割引率<span class="math inline">R_F</span>と将来受け取る時点である<span class="math inline">T</span>に依存している。<span class="math inline">CF_T = 100</span>の場合、<span class="math inline">R_F</span>と<span class="math inline">T</span>の変化に応じて現在価値がどのように変化するのか確認する。</p>
<p><span class="math inline">T=1</span>として、横軸を割引率、縦軸を現在価値としたグラフが以下のものである。 割引率が大きくなるにつれて現在価値が小さくなることが分かる。</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="KM_Lecture_02_files/figure-html/pv_rf-1.png" class="img-fluid" width="768"></p>
</div>
</div>
<p>次に、<span class="math inline">R_F = 0.1</span>として、横軸を<span class="math inline">T</span>、縦軸を現在価値としてグラフが以下のものである。 キャッシュ・フローを受け取る時点が遠くなるほど、現在価値が小さくなることがわかる。</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="KM_Lecture_02_files/figure-html/pv_T-1.png" class="img-fluid" width="768"></p>
</div>
</div>
</section>
<section id="不確実なキャッシュフローに対する割引率" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="不確実なキャッシュフローに対する割引率">不確実なキャッシュ・フローに対する割引率</h3>
<p><strong>リスクプレミアム</strong>(risk premium)の反映が割引率の2つ目の役割である。 通常、将来キャッシュ・フローがいくらになるのか分からないのが普通であり、<span class="math inline">CF</span>は様々な要因で変化する確率変数(random variable)であるため、現時点における<strong>期待値</strong>(expected value)で評価される。</p>

<div class="no-row-height column-margin column-container"><div class="">
<p>ここで、期待値をとる演算子(operator)を<span class="math inline">\mathbb{E}</span>で表し、期待値をとる時点を添え字で表す。ここでは現時点<span class="math inline">t=0</span>における期待値を<span class="math inline">\mathbb{E}_0</span>と表現している。 たとえば，現時点を<span class="math inline">t=0</span>として，1期先に起こりうる結果<span class="math inline">X</span>が<span class="math inline">100</span>か<span class="math inline">200</span>であることが分かっていて，それぞれの発生確率が50%であったとする。この将来に起こりうる結果を現時点での情報を基に期待値をとる，ということは， <span class="math display">
\mathbb{E}[X] = 0.5 \times 100 + 0.5 \times 200 = 150
</span> となる。このように起こりうる結果と発生確率を掛けて足したものを<strong>期待値</strong>という。</p>
</div></div><p>リスクプレミアムは割引率の調整で定量化される。</p>
<p><span class="math display">
PV_0 = \frac{\mathbb{E_0}[CF_1]}{1+R_F+\underbrace{(\tilde{R}-R_F)}_{\text{リスクプレミアム}}}=\frac{\mathbb{E_0}[CF_1]}{\underbrace{1+\tilde{R}}_{\text{リスク調整済み割引率}}}
</span></p>
<p>割引率は時間価値やリスクプレミアムに関する定量的な情報を含むので、タイミングやリスクの異なるキャッシュフローを現在価値という同一の尺度で評価できる。</p>
</section>
<section id="npv法" class="level3">
<h3 class="anchored" data-anchor-id="npv法">NPV法</h3>
<p><strong>NPV法</strong>とは、割引現在価値(net present value: 以下NPV)を基準に投資の意思決定を行う考え方をいう。</p>
<p>投資を目論む現時点を時点0とする。 <span class="math inline">CF_0</span>は時点0での投資を意味し、企業の財布から現金が減るためマイナスになる。</p>
<p>向こうT年間にわたり毎年<span class="math inline">\mathbb{E}[CF_t],\quad t = 1,\dots ,T</span>の期待キャッシュフローが生み出されるならば、それらを割引率<span class="math inline">1 + \tilde{R}</span>で現在価値に直して足し合わせた値(つまりNPV)が、現時点で評価したプロジェクトの成果である。</p>
<p>NPVはそのプロジェクトから発生するすべてのキャッシュフローの現在価値として解釈できる。 コーポレートファイナンスでは，</p>
<ul>
<li>NPVがゼロ以上のプロジェクトは投資を実行</li>
<li>NPVが負のプロジェクトは投資を見送る</li>
</ul>
<p>ことを推奨する。</p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
例: プロジェクトA
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>現時点(<span class="math inline">t=0</span>)で280万円の初期投資が必要</li>
<li>1年後に 115万円の期待キャッシュフロー</li>
<li>2年後に 264.5万円の期待キャッシュフロー</li>
<li>無リスク金利 0.1，リスクプレミアム0.05とするときの割引率0.15</li>
</ul>
<p>プロジェクトの成果を将来キャッシュフローの現在価値によって評価する。 2年分の将来キャッシュフローの現在価値を足し合わせて300万円</p>
<p><span class="math display">
\text{プロジェクトAの成果} = \frac{115}{1.15}+\frac{264.5}{1.15^2}=300
</span></p>
<p>よって、<span class="math inline">NPV = -280 + 300 = 20 &gt;0</span></p>
</div>
</div>
<p>一般的なNPV法は以下のようにかかれる。 <span class="math display">
\begin{aligned}
NPV_0 &amp;= \frac{CF_0}{(1+\tilde{R})^0}+\frac{\mathbb{E}[CF_1]}{(1+\tilde{R})^1}+\frac{\mathbb{E}[CF_2]}{(1+\tilde{R})^2}+ \cdots +\frac{\mathbb{E}[CF_T]}{(1+\tilde{R})^T}\\
&amp;= \underbrace{CF_0}_{\tiny 初期投資額}+
\underbrace{\sum_{t=1}^T\frac{\mathbb{E}[CF_t]}{(1+\tilde{R})^t}}_{\tiny 現時点で評価した成果}
\end{aligned}
</span></p>
</section>
<section id="配当割引モデル" class="level3">
<h3 class="anchored" data-anchor-id="配当割引モデル">配当割引モデル</h3>
<p>NPVの考え方を株式に適用する。株式から生み出される将来得られるキャッシュ・フローは、一株当たり配当(Dividend Per Share: DPS)であり、<span class="math inline">t</span>時点の一株当たり配当を<span class="math inline">D_t</span>で表す。 将来DPSは確率変数であるため期待値で考え、それを割引率<span class="math inline">\tilde{R}</span>で割り引くことで、一株当たりの株式価値を求める。</p>
<p><span class="math display">
\begin{aligned}
P_0^* &amp;= \frac{\mathbb{E_0}[D_1]}{1 + \tilde R} + \frac{\mathbb{E_0}[D_2]}{(1 + \tilde R)^2} + \cdots + \frac{\mathbb{E_0}[D_{\infty}]}{(1 + \tilde R)^{\infty}} \\
&amp;= \sum^{\infty}_{t=1}\frac{\mathbb{E_0}[D_t]}{(1+\tilde{R})^t}
\end{aligned}
</span></p>
</section>
<section id="ゴードン成長モデル" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="ゴードン成長モデル">ゴードン成長モデル</h3>
<p>期待DPSが<strong>一定の割合で成長</strong>していくと仮定した割引配当モデルを<strong>ゴードン成長モデル</strong>という。 直近の実現したDPSを<span class="math inline">D_0</span>と置き、将来にわたってこの配当の期待値が一定割合<span class="math inline">G</span>%で成長していくと仮定する。つまり1時点先の配当額が<span class="math inline">(1 + G)D_0</span>となる、と仮定する。 すると、<span class="math inline">t</span>時点先の配当額<span class="math inline">\mathbb{E}[D_t]</span>は、 <span class="math display">
\begin{aligned}
\mathbb{E}[D_t] &amp;= D_0 \times \underbrace{(1+G) \times \cdots \times (1+G)}_{複利でt回}\\
&amp;= (1+G)^tD_0
\end{aligned}
</span> で表すことができる。 一定割合で配当額が成長する株式の理論価値<span class="math inline">P_0</span>を配当割引モデルで計算すると， <span class="math display">
\begin{aligned}
P_0 &amp;= \frac{(1+G) D_0}{(1+\tilde{R})} + \frac{(1+G)^2 D_0}{(1+\tilde{R})^3} + \frac{(1+G)^3 D_0}{(1+\tilde{R})^3} + \cdots \\
    &amp;= \sum^{\infty}_{t=1}\frac{(1+G)^tD_0}{(1+\tilde{R})^t} \\
    &amp;=\frac{(1+G)D_0}{\tilde{R}-G}
\end{aligned}
</span> 2本目の式から3本目の式への計算で、<strong>等比級数の和の公式</strong>を利用している。</p>

<div class="no-row-height column-margin column-container"><div class="">
<p>初項<span class="math inline">a</span>，公比<span class="math inline">r</span>の等比数列 <span class="math display">
a, ar, ar^2, ar^3, \dots , ar^{n-1},ar^n , \dots
</span> がある。この等比数列の和を<span class="math inline">S_n</span>で表す。 <span class="math display">
S_n = a + ar + ar^2 + \cdots + ar^{n-1} + \cdots
</span> 両辺に<span class="math inline">r</span>を乗じると， <span class="math display">
rS_n =  ar + ar^2 + \cdots + ar^{n-1} + ar^{n} + \cdots
</span> となる。そして，<span class="math inline">S_n - rS_n</span>を計算すると， <span class="math display">
\begin{aligned}
S_n - r S_n &amp;= a\\
(1-r)S_n &amp;= a\\
S_n &amp;= \frac{a}{1-r}
\end{aligned}
</span> 上のゴードン成長モデルの初項は<span class="math inline">(1+G)D_0/(1+\tilde R)</span>，公比は<span class="math inline">(1 +G)/(1+\tilde R)</span>なので， <span class="math display">
\begin{aligned}
S_n
%P_0^* &amp;= \frac{(1+G)D_0}{1+ \tilde R} + \frac{(1+G)^2 D_0}{(1+ \tilde R)^2} + \frac{(1+G)^3 D_0}{(1+ \tilde R)^3} + \cdots \\
&amp;= \displaystyle  \frac{\frac{(1+G)D_0}{(1 + \tilde R)}}{1 - \frac{1+G}{1+\tilde R}}\\
&amp;= \displaystyle  \frac{\frac{(1+G)}{(1 + \tilde R)}D_0}{\frac{(1+ \tilde R) - (1+G)}{1+\tilde R}}\\
%&amp;= \displaystyle  \frac{\frac{(1+G)}{(1 + \tilde R)}D_0}{\frac{\tilde R - G}{1+\tilde R}}\\
&amp;= \displaystyle  \frac{1+G}{\tilde R - G}D_0\\
\end{aligned}
</span> ただし，<span class="math inline">\tilde{R} \not = G</span>の場合のみである。</p>
</div></div></section>
<section id="割引率と期待リターンの関係" class="level3">
<h3 class="anchored" data-anchor-id="割引率と期待リターンの関係">割引率と期待リターンの関係</h3>
<p>割引率<span class="math inline">R</span>は投資家が将来キャッシュフローを購入するにあたって最低限要求する期待リターン(<strong>要求収益率</strong>)とも解釈できる。</p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
例
</div>
</div>
<div class="callout-body-container callout-body">
<p>1年後の期待DPSが100万円で配当支払後に即解散する予定(=DPSがゼロ)の企業の理論株価を考える。 たとえば，確率50%で配当が200となるが，確率50％で配当が0となる株式を考えてみる。期待配当は，<span class="math inline">0.5 \times 200 + 0.5 \times 0 = 100</span>となる。</p>
<p>リスク調整済みの割引率<span class="math inline">r = 0.25</span>であるときの現在価値は<span class="math inline">100/(1 + 0.25)</span>で理論株価は80万円となる。 この株式を購入するか検討している投資家にとって、「現時点でこの株式を購入し、1年後に配当を受け取ることは一種の投資プロジェクト」とみなせる。 この投資プロジェクトに対して必要な投資額は現時点の株価<span class="math inline">P_0</span>であり、現時点で評価した成果は配当として受け取り予定の将来キャッシュフローの現在価値<span class="math inline">P^*_0</span>である。 よって、 <span class="math display">
NPV = -P_0 + P_0^*
</span> したがって、市場価値が理論株価以下である限り、NPVが非負となるためこの株式を購入することが経済合理的である。 <span class="math display">
NPV  \geq 0 \Leftrightarrow P_0 \leq P^*_0 =80
</span> つまり株式を80未満の価格で購入できれば、NPVがプラスとなる。</p>
</div>
</div>
</section>
</section>
<section id="平均分散アプローチ入門" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="平均分散アプローチ入門">平均分散アプローチ入門</h2>
<p>個々の投資家にとって最適となる証券の組み合わせの比率を決めることを<strong>最適ポートフォリオ選択</strong>という。 分散投資によりリスクを逓減できる、という現象がなぜ生じるのかを、数理的に明らかにする。 このアプローチを<strong>平均・分散アプローチ</strong>といい、ポートフォリオの望ましさを、ポートフォリオのリターンの期待値と分散で評価する。</p>
<section id="ポートフォリオのリスクとリターン" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="ポートフォリオのリスクとリターン">ポートフォリオのリスクとリターン</h3>
<p>いま、銘柄Aと銘柄Bの2銘柄のみが投資対象である場合を考える。 それぞれの銘柄への投資割合を<span class="math inline">w_A</span>と<span class="math inline">w_B</span>とし、<span class="math inline">w_A + w_B = 1</span>とする。</p>
<ul>
<li>元本 <span class="math inline">X</span></li>
<li>投資銘柄Aのリターン <span class="math inline">1 + R_A</span></li>
<li>投資銘柄Bのリターン <span class="math inline">1 + R_B</span></li>
</ul>
<p>元本<span class="math inline">X</span>のうち<span class="math inline">w_A</span>分だけ銘柄Aに投資すると、1年後に期待値で<span class="math inline">\mathbb{E}[X \times w_A \times (1+R_A)]</span>になる。銘柄Bについても同様に考えると、手元にある元本を全額銘柄AとBに振り分けると、 <span class="math display">
\begin{aligned}
(1+R_A) w_A X + ( 1 + R_B) w_B X
&amp;= w_AX + w_AR_AX + w_BX + w_B R_B X\\
&amp;= \left [\underbrace{(w_A+w_B)}_{\text{定義より} = 1}+(w_AR_A+w_BR_B) \right ]X\\&amp;=(1+w_AR_A+w_BR_B)X
\end{aligned}
</span> となる。元本を2銘柄に投資すると、1年後に<span class="math inline">(1+w_AR_A+w_BR_B)X</span>となる。 1年後の価値と初期投資額の比としてこのポートフォリオのリターン<span class="math inline">R_P</span>を計算する。 <span class="math display">
\begin{aligned}
\frac{\overbrace{(1+R_A)w_AX+(1+R_B)w_BX}^{将来時点の評価額}}{\underbrace{X}_{初期投資}} &amp; = 1 + w_A R_A + w_B R_B
\end{aligned}
</span> ここで、<span class="math inline">w_AR_A + w_B R_B = R_P</span>とおくと、 <span class="math display">
\text{ポートフォリオのリターン} = 1 + R_P
</span> となる。 元本を除いたポートフォリオのリターン<span class="math inline">R_P</span>は、構成銘柄のリターンを保有比率で加重平均した値となる。</p>

<div class="no-row-height column-margin column-container"><div class="">
<p>リターンの定義<span class="math inline">(P_t - P_{t-1})/P_{t-1} = P_t/P_{t-1} -1</span>は<strong>ネット・リターン</strong>(net return)と呼ばれるものである。 これにたいして，元本も含めたリターン<span class="math inline">1 + R_t = P_t/P_{t-1}</span>は<strong>グロス・リターン</strong>(gross return)という。</p>
</div></div><p><strong>ポートフォリオ構築時には、各銘柄の実現リターンはわからない</strong>ので(つまり確率変数)、かわりに期待値や分散を評価する。</p>
<p>銘柄Aと銘柄Bのネット・リターンの</p>
<ul>
<li>期待値<span class="math inline">\mathbb{E}[R_A]</span>と<span class="math inline">\mathbb{E}[R_B]</span>をそれぞれ<span class="math inline">(\mu_A,\mu_B)</span></li>
<li>分散<span class="math inline">\mathbb{V}[R_A]</span>と<span class="math inline">\mathbb{V}[R_B]</span>をそれぞれ<span class="math inline">(\sigma^2_A,\sigma^2_B)</span></li>
<li>共分散<span class="math inline">\mathbb{Cov}[R_A, R_B]</span>を<span class="math inline">\sigma_{AB}</span></li>
</ul>
<p>で表す。</p>
<p>リターン<span class="math inline">R_A</span>と<span class="math inline">R_B</span>の相関係数を<span class="math inline">\rho</span>と表記する。相関係数の定義から、 <span class="math display">
\begin{aligned}
\rho
%&amp;= \frac{\mathbb{E}[(R_A - \bar R_A)(R_B - \bar R_B)]}{\mathbb{E}[(R_A - \bar R_A)^2]}
&amp;= \frac{\sigma _{AB}}{\sigma _A \sigma _B} \\
\Leftrightarrow \sigma_{AB} &amp; = \rho\sigma_A\sigma_B
\end{aligned}
</span> が成立する。</p>
<p>上の式より、<span class="math inline">R_P = w_A R_A + w_B R_B</span>であるから、その期待値<span class="math inline">\mathbb{E}[R_P] = \mu_P</span>も各銘柄の期待リターンの加重平均となる。ここで投資割合<span class="math inline">w_A</span>と<span class="math inline">w_B</span>はパラメータであり，<span class="math inline">R_A, R_B</span>は確率変数である。 <span class="math display">
\begin{aligned}
\mathbb{E}[R_p] = \mu_P &amp;= \mathbb{E}[w_A R_A + w_B R_B]\\
&amp;= w_A \mathbb{E}[R_A] + w_B \mathbb{E}[R_B]\\
&amp;=w_A\mu_A+w_B\mu_B
\end{aligned}
</span></p>
<p>ポートフォリオPの分散<span class="math inline">\mathbb{V}[R_P] = \sigma^2_P</span>は各銘柄の分散及び相関係数を用いて計算できる。</p>
<p><span class="math display">
\begin{aligned}
\mathbb{V}[R_P] = \sigma_P^2 &amp;= \mathbb{V}[w_A R_A + w_B R_B]\\
&amp;= w_A^2 \mathbb{V}[R_A] + w_b^2 \mathbb{V}[R_B] + 2 w_A w_B \mathbb{Cov}[R_A,R_B]\\
&amp;= w_A^2 \sigma_A^2 + w_B^2 \sigma_B^2 + 2w_A w_B \sigma _{AB}\\
&amp;= w^2_A \sigma^2_A + w^2_B \sigma^2_B +
\underbrace{2 w_A w_B \rho \sigma_A \sigma_B}_{ここの\rho の符号が重要}
\end{aligned}
</span></p>
<p>ポートフォリオPの分散は，各銘柄の分散に投資割合の二乗を乗じたものに，各銘柄のリターンの相関関係部分を加えたものとなっている。 つまり，この2銘柄のリターンの相関係数<span class="math inline">\rho</span>に応じて，ポートフォリオPの分散が大きくなるかどうかが決まる，ということである。</p>
</section>
<section id="分散投資のメリット" class="level3">
<h3 class="anchored" data-anchor-id="分散投資のメリット">分散投資のメリット</h3>
<p>保有比率<span class="math inline">(w_A,w_B)</span>を変化させたときのポートフォリオの<span class="math inline">\mu_P</span>と<span class="math inline">\sigma_P</span>がそのように変化するかを確認する。</p>
<p><span class="math display">
\begin{aligned}
\mathbb{V}[R_P] = \sigma_P^2 &amp;= w^2_A \sigma^2_A + w^2_B \sigma^2_B + 2\rho{w_Aw_B\sigma_A\sigma_B}\\
&amp;= (w_A \sigma_A + w_B \sigma_B)^2 - 2w_A  w_B \sigma _A \sigma_B + 2\rho{w_Aw_B\sigma_A\sigma_B}\\
&amp;= (w_A \sigma_A + w_B \sigma_B)^2 - (2 + 2\rho ) w_A w_B\sigma_A\sigma_B\\
&amp;=(w_{A} \sigma_{A} + w_{B}\sigma_{B})^{2} - \underbrace{2(1-\rho )w_{A}w_{B} \sigma_{A}\sigma_{B}}_{ここ重要}
\end{aligned}
</span> <span class="math inline">0 \leq w_{A} \leq 1</span>かつ <span class="math inline">0 \leq w_{B} \leq 1</span>のとき、 <span class="math display">
2 ( 1- \rho ) w_A w_b \sigma _A \sigma _B \geq 0
</span> となる(<span class="math inline">\rho = 1</span>のときのみ<span class="math inline">0</span>となる)。 したがって、 <span class="math display">
\begin{aligned}
\sigma_P^2 = (w_{A}\sigma_{A}+w_{B}\sigma_{B})^{2} - \underbrace{2(1-\rho )w_{A}w_{B} \sigma_{A}\sigma_{B}}_{\geq 0}
\end{aligned}
</span> から、 <span class="math display">
\begin{aligned}
&amp; \sigma _P^2 \leq (w_A \sigma _A + w_B \sigma _B)^2 \\
\Longleftrightarrow &amp; \sigma_{P}  \leq
\underbrace{w_{A}\sigma_{A}+w_{B}\sigma_{B}}_{リスクの加重平均}
\end{aligned}
</span> となり，ポートフォリオのリスクを表す標準偏差<span class="math inline">\sigma_P</span>が銘柄AとBの標準偏差の加重平均<span class="math inline">w_{A}\sigma_{A} + w_{B} \sigma_{B}</span>より少なくとも低くなることがわかる。 これを<strong>分散投資効果</strong>という。</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="KM_Lecture_02_files/figure-html/diversified_investment-1.png" class="img-fluid" width="768"></p>
</div>
</div>
<p>完全な負の相関<span class="math inline">(\rho=-1)</span>であるの場合、<span class="math inline">\sigma^{2}_{P}=0</span>のポートフォリオを構築できる。 確認のため、2銘柄の価格が完全な負の相関<span class="math inline">\rho = -1</span>をもつとき、ポートフォリオPのリスク<span class="math inline">\sigma_P</span>は <span class="math display">
\begin{aligned}
\mathbb{V}[R_P] = \sigma ^2_P &amp;=(w_{A}\sigma_{A}+w_{B}\sigma_{B})^{2}-2(1- (-1))w_{A}w_{B} \sigma_{A}\sigma_{B}\\
&amp;= (w_{A}\sigma_{A}+w_{B}\sigma_{B})^{2} -4w_{A}w_{B} \sigma_{A}\sigma_{B}\\
&amp;= w_A ^2 \sigma _A^2 + w_B^2\sigma _B^2 + 2w_A w_B \sigma_A \sigma_B -4w_{A}w_{B} \sigma_{A}\sigma_{B}\\
&amp;= w_A ^2 \sigma _A^2 - 2w_{A}w_{B} \sigma_{A}\sigma_{B} + w_B^2\sigma _B^2 \\
&amp;= (w_{A}\sigma_{A} - w_{B}\sigma_{B})^{2}\\
\sigma _P &amp;= | w_{A}\sigma_{A} - w_{B}\sigma_{B}|
\end{aligned}
</span></p>
<p>以下のように，<span class="math inline">w_A \sigma _A = w_B \sigma_B</span>となるように<span class="math inline">w_A</span>と<span class="math inline">w_B</span>を選べば、<span class="math inline">\sigma _P = 0</span>となるポートフォリオを作れる。</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="KM_Lecture_02_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid" width="768"></p>
</div>
</div>
<p>このケースでは、<span class="math inline">\sigma_A = 0.2</span>、<span class="math inline">\sigma_B = 0.3</span>となっているため、<span class="math inline">0.2w_A = 0.3w_B</span>となる保有割合を考える。 <span class="math display">
\begin{aligned}
0.2 w_A &amp;= 0.3w_B\\
0.2 w_A &amp;= 0.3(1-w_A)\\
0.2 w_A &amp;= 0.3 - 0.3w_A\\
0.5 w_A &amp;= 0.3\\
w_A &amp;= 0.6
\end{aligned}
</span> となるため、銘柄Aに60％、銘柄Bに40%を投資することで、リスクゼロで期待リターン<span class="math inline">0.6\times0.1 + 0.4 \times 0.2 = 0.14</span>を獲得することができる。</p>
</section>
<section id="空売りの効果" class="level3">
<h3 class="anchored" data-anchor-id="空売りの効果">空売りの効果</h3>
<p>空売り(short sale)とは、 1. 保有していない証券を誰か(普通は証券会社)から借りてきて売却し、 2. 一定期間後に買い戻して元の持ち主に返却する 取引をいい、<strong>値下がりから利益を得る</strong>。 空売りを行う投資家をショートセラー(short seller)という。</p>
<p>いままでは、<span class="math inline">0 \leq w_A,w_B \geq 1</span>＄という制約を置いていたが、この制約をはずして、 <span class="math inline">w_A + w_B = 1</span>のみを課す。つまり<span class="math inline">w_A&lt;0</span>や<span class="math inline">w_B&lt;0</span>が空売りを表す。</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="KM_Lecture_02_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="768"></p>
</div>
</div>
</section>
<section id="安全資産の導入" class="level3">
<h3 class="anchored" data-anchor-id="安全資産の導入">安全資産の導入</h3>
<p><strong>安全資産の購入</strong>についても考える。</p>
<p>安全資産Fのリターンを<span class="math inline">R_F</span>、 ポートフォリオPの保有比率を<span class="math inline">w_F</span>とおく（安全資産のリターンは確実に実現する成果なので，確率変数を表すチルダをつけてない）。 以降は，確率変数にはなるべくチルダをつける。銘柄Aと銘柄Bと安全資産の投資割合をそれぞれ<span class="math inline">w_A, w_B, w_F</span>で表す。</p>
<p>まず銘柄Aと安全資産の2資産からなるポートフォリオを考える。 つまり各資産への投資割合を<span class="math inline">w_A + w_F = 1,\quad w_B = 0</span> とする場合を考える。 この安全資産と銘柄AからなるポートフォリオPの(ネット)リターン<span class="math inline">\tilde R_P</span>は， <span class="math display">
\tilde R_{P} = w_{F} R_{F} + w_{A} \tilde R_{A}
</span> となり，このポートフォリオの期待値は， <span class="math display">
\begin{aligned}
\mu_{P} =\mathbb{E}[R_P] &amp;=\mathbb{E}[ w_F R_{F} + w_{A} \tilde{R_A} ]\\
&amp;=w_F R_{F}+w_{A} \mathbb{E}[\tilde{R_A}]\\
&amp;=w_F R_{F}+w_{A} \mu_{A}\\
&amp;=(1-w_A) R_{F}+w_{A} \mu_{A}\\
&amp;=R_{F} - w_{A}R_F + w_A\mu_A\\
&amp;=R_{F} + w_A(\underbrace{\mu_A - R_F}_{\tiny リスクプレミアム})
\end{aligned}
</span></p>
<p>となる。もちろん安全資産のリターンは確率変数でないので，期待値をとってもそのままである。 <span class="math inline">\mu_{A}-R_{F}</span> はリスク資産である銘柄Aの<strong>リスクプレミアム</strong>を表している。通常，リスクのある資産の期待リターンは安全資産のリターンより大きいため，リスクプレミアムは正の値となる。したがって，リスク資産への投資割合<span class="math inline">w_A</span>を1単位増加させれば，<span class="math inline">\mathbb{E}[R_P]</span>はリスクプレミアム分増加する</p>
<p>つぎに，ポートフォリオのリスクを表す標準偏差<span class="math inline">\sigma _P</span>とリターンの関係は次式で表せる。まず安全資産のリスクはゼロであるため，リスク資産の銘柄Ａを保有する分だけリスクが生じる。</p>
<p>つぎに，ポートフォリオのリスクを表す標準偏差<span class="math inline">\sigma _P</span>とリターンの関係は次式で表せる。まず安全資産のリスクはゼロであるため，リスク資産の銘柄Ａを保有する分だけリスクが生じる。</p>
<p><span class="math display">
\begin{aligned}
\sigma_P^2 = \mathbb{V}[R_P]  &amp;= \mathbb{V}[w_FR_F + w_A R_A]\\
&amp;= \mathbb{V}[w_A R_A]\\
&amp;= w_A^2 \mathbb{V}[R_A]\\
&amp;= w_A^2 \sigma _A^2 \\
\sigma _P &amp; = |w_A| \sigma_A
\end{aligned}
</span></p>
<p>空売りを想定する場合<span class="math inline">w_A &lt; 0</span>となるため，標準偏差を求める際に絶対値をとっている。空売りはない状況（つまり，<span class="math inline">w_A&gt;0</span>）を想定すると，</p>
<p><span class="math display">
\begin{aligned}
\sigma _P = w_A \sigma _A\\
w_A = \frac{\sigma_P}{\sigma _A}
\end{aligned}
</span></p>
<p>のように，リスク資産である銘柄Aへの投資割合<span class="math inline">w_A</span>が，ポートフォリオPとリスク資産Aのリスクの割合で決定されることがわかる。これを，ポートフォリオの期待リターン<span class="math inline">\mu_P</span>に代入すると，</p>
<p><span class="math display">
\begin{aligned}
\mu_{P} &amp;= R_F + w_A(\mu_A - R_F)\\
&amp; = R_F + \frac{\sigma_P}{\sigma _A}(\mu_A - R_F) \\
&amp;= R_{F}+\frac{\mu_{A}-R_{F}}{\sigma_{A}}\sigma_{P}
\end{aligned}
</span></p>
<p>となり，期待リターン<span class="math inline">\mu_P</span>は，切片が<span class="math inline">R_F</span>，傾きが<span class="math inline">(\mu_A - R_F)/\sigma_A</span>とする<span class="math inline">\sigma_P</span>の線形関数となる。</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="KM_Lecture_02_files/figure-html/graph_02-1.png" class="img-fluid" width="960"></p>
</div>
</div>
</section>
<section id="資産のポートフォリオ" class="level3">
<h3 class="anchored" data-anchor-id="資産のポートフォリオ">3資産のポートフォリオ</h3>
<p>リスク資産AとB，安全資産Fの3資産に投資するポートフォリオを考える。 ここで，<span class="math inline">w_A + w_B &gt; 0</span>を仮定し，少なくとも少しはリスク資産を保有するケースを考える。 当然だけれど，<span class="math inline">w_A = w_B =0</span>のケースでは，安全資産のみを保有するケースとなり，リスクも無く，リターンも確定している。</p>
<p>3資産A,B,Fへの投資割合をそれぞれ<span class="math inline">w_A</span>，<span class="math inline">w_B</span>,<span class="math inline">w_F</span>とすると， 3資産からなるポートフォリオの期待リターンは次のように計算できる。 <span class="math display">
\begin{aligned}
\mathbb{E}[R_{P}] &amp;= w_FR_F + w_A \mathbb{E} [\tilde R_A] + w_B \mathbb{E}[ \tilde R_B] \\
&amp; =
w_{F} R_{F} + (w_{A} + w_{B}) \left(\frac{w_{A}}{w_{A}+w_{B}} \mathbb{E} [\tilde R_{A}] + \frac{w_{B}}{w_{A}+w_{B}} \mathbb{E}[ \tilde R_{B} ]\right)
\end{aligned}
</span> 安全資産への投資割合<span class="math inline">w_F</span>とリスク資産への投資割合<span class="math inline">w_C = w_A + w_B</span>とまとめて，式を変形させる。 安全資産への投資以外の資金で構築したリスク資産AとBからなるポートフォリオを<span class="math inline">P_C</span>を考えると，<span class="math inline">P_C</span>の期待リターン<span class="math inline">R_C</span>は次のように計算できる。 <span class="math display">
\begin{aligned}
R_{C} &amp;= \frac{w_{A}}{w_{A}+w_{B}} \mathbb{E}[\tilde R_{A}] + \frac{w_{B}}{w_{A}+w_{B}}\mathbb{E}[ \tilde R_{B}]\\
\end{aligned}
</span></p>
<p>安全資産FとポートフォリオCを保有した場合の期待リターンは次式となる。</p>
<p><span class="math display">
\begin{aligned}
\mu_{P} &amp; = \mathbb{E}[w_F R_F + w_A R_A + w_B R_B]\\
&amp;= w_FR_F + w_A \mathbb{E}[R_A] + w_B \mathbb{E}[R_B]\\
&amp;= w_FR_F + (w_A + w_B) \underbrace{ \left( \frac{w_A}{w_A + w_B} \mathbb{E}[R_A] + \frac{w_B}{w_A + w_B} \mathbb{E}[R_B] \right )}_{=w_C\text{とおく}}\\
&amp;= w_F R_F + w_{C}\mu_C
\end{aligned}
</span></p>
<p>安全資産と2つのリスク資産からなるポートフォリオの期待リターンは，安全資産の期待リターンとリスク資産の期待リターンの和となる。</p>
<p>安全資産と2つのリスク資産に投資可能な場合，<span class="math inline">(\mu_P, \sigma _P)</span>の取りうる値を図示できる。テキストの数値例を用いてRで図示してみる。</p>
<ul>
<li>リスク資産Aの期待リターン 0.1，標準偏差 0.2</li>
<li>リスク資産Bの期待リターン 0.2，標準偏差 0.3</li>
<li>安全資産の期待リターンを 0.01</li>
<li>リスク資産AとBの間の相関係数は0.2</li>
<li>安全資産，銘柄A，銘柄Bへの投資割合を0.2，0.3，0.5とするポートフォリオを考える。このポートフォリオの期待リターン<span class="math inline">\mu_P</span>と標準偏差<span class="math inline">\sigma_P</span>は次のようになる。</li>
</ul>
</section>
</section>
<section id="最適ポートフォリオ問題" class="level2">
<h2 class="anchored" data-anchor-id="最適ポートフォリオ問題">最適ポートフォリオ問題</h2>
<p>「どのようなポートフォリオが投資家にとって望ましいか」</p>
<p>一般に、投資家はリスクが小さい一方でリターンが大きいポートフォリオを好む。 ここでは，リターンをポートフォリオの期待リターン<span class="math inline">\mu_P</span>，リスクをポートフォリオの標準偏差<span class="math inline">\sigma _P</span>で表し，この2つの変数から更正される平面<span class="math inline">(\mu_P, \sigma_P)</span>上で最適ポートフォリオ問題を分析する。</p>
<section id="効率的フロンティア" class="level3">
<h3 class="anchored" data-anchor-id="効率的フロンティア">効率的フロンティア</h3>
<p>リスク資産Aと資産Bにのみ投資可能であり，それぞれに異なる割合で投資したポートフォリオDとＥを比較する(以下の図）</p>
<ul>
<li>標準偏差はともに0.25 <span class="math inline">\sigma _D = \sigma _E = 0.25</span></li>
<li>Dの方がEよりも期待リターンが大きい，<span class="math inline">\mu _D &gt; \mu _E</span></li>
</ul>
<p>つまり，同じリスク（標準偏差）ならリターン（期待リターン）が高いポートフォリオに投資したほうがよい。よってリスク・リターンのトレードオフの意味でDの方がEよりも望ましい。 以下のグラフでいうと、同じリスク(緑のライン上)なら、リターンの高いポートフォリオが望ましい。そのため赤い実線が効率的フロンティアとなり、青い点線は選択されないポートフォリオになる。</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="KM_Lecture_02_files/figure-html/graph_optimal_portofolio-1.png" class="img-fluid" width="768"></p>
</div>
</div>
<p>リスク資産AとBに加え、安全資産Fにも投資可能な場合、効率的フロンティアは<strong>直線</strong>になる。 この場合、効率的フロンティアは<strong>資本市場線</strong>(Capital Market Line; CML)とも呼ばれる。 傾きは、この金融市場におけるリスクとリターンのトレードオフを表す。</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="KM_Lecture_02_files/figure-html/capital_market_line-1.png" class="img-fluid" width="768"></p>
</div>
<div class="cell-output-display">
<p><img src="KM_Lecture_02_files/figure-html/capital_market_line-2.png" class="img-fluid" width="768"></p>
</div>
</div>
</section>
<section id="投資家のリスク回避度と最適ポートフォリオ" class="level3">
<h3 class="anchored" data-anchor-id="投資家のリスク回避度と最適ポートフォリオ">投資家のリスク回避度と最適ポートフォリオ</h3>
<p>効率的フロンティアのうち、どの点が投資家の最適ポートフォリオになるのか，について考える。 そのためには投資家のリスク・リターンのトレードオフに関する<strong>選好(preference)</strong>の特徴，つまり<strong>リスクの回避度</strong>の情報が必要となる。 <span class="math inline">(\mu_P,\rho_p)</span>平面上でそれを描く方法の一つが<strong>無差別曲線</strong>(indifference curve)である。 <strong>無差別曲線</strong>とは，投資家の効用(utility)が<strong>一定</strong>となるリスクとリターンの組み合わせを描いた曲線をいう。つまり同じ効用水準を達成できるリスクとリターンの組み合わせを表現した曲線である。</p>
<section id="効用関数の例" class="level4">
<h4 class="anchored" data-anchor-id="効用関数の例">効用関数の例</h4>
<p>以下では，財<span class="math inline">x</span>と<span class="math inline">y</span>を消費したときの効用<span class="math inline">U</span>を図示している。この消費者の効用関数は<span class="math inline">U(x,y) = x^{\frac 25} \times y^{\frac 35}</span>としている。</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="KM_Lecture_02_files/figure-html/utility_function-1.png" class="img-fluid" width="768"></p>
</div>
</div>
<p>この立体図を等高線を使って表現したものが以下の図である。 青いラインは予算制約であり、予算の範囲内で購入可能な財の組み合わせを意味している。つまり、この予算制約と無差別曲線が接する点が、予算内で達成可能な最も高い効用水準を表している。</p>
<p>無リスク利子率が10%で，リスクプレミアムが5％，βが1.2の場合の期待リターンは，<span class="math inline">R_F + \beta \times (R_M - R_F) = 0.1 + 1.2 \times 0.05 = 0.16</span>となる。このときの無差別曲線は，<span class="math inline">U = 0.16</span>となるような点を結んだ曲線となる。</p>
<div class="cell" data-fig.aligned="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="KM_Lecture_02_files/figure-html/indifference_curve-1.png" class="img-fluid figure-img" width="576"></p>
<p></p><figcaption class="figure-caption">無差別曲線と消費可能集合</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>リスクとリターンの無差別曲線</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/KM_fig_2-12.jpg" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">無差別曲線と効率的フロンティアに基づく最適ポート フォリオの決定</figcaption><p></p>
</figure>
</div>
<p>複数ポートフォリオを比べるとき，この図の左上のものほど高リターン低リスクに対応するので、より高い効用水準が実現する。 また無差別曲線の<strong>局所的な傾き</strong>は、その投資家が追加的なリスクを引き受けるうえで要求するリスクプレミアムを表す。 リスク回避的な投資家ほど，リスクを1単位負担する際に，より大きなリスクプレミアムを要求するので、傾きは大きくなる。 つまり，1単位リスクを負担する代わりに欲しいリターンの額が大きくなるほど，傾きが大きくなる。</p>
<p>無差別曲線と効率的フロンティアが接する点が、この投資家にとっての最適ポートフォリオとなる。 投資可能なポートフォリオの範囲で、最も左上の無差別曲線を実現するのが接点となる。 どの点が最適ポートフォリオとして選ばれるかは個々の投資家の無差別曲線の形状(リスク回避度)に依存する。最適ポートフォリオにおいて、無差別曲線と効率的フロンティアの局所的な傾きは一致(接線だから当然)するため、その投資家が要求するリスクプレミアムがちょうど実現されている。</p>
<p>上図の場合，この投資家の最適ポートフォリオは<span class="math inline">(w_F,w_{tan})\approx(0.29,0.71)</span>の比率で構成される。</p>
<p>接点ポートフォリオは銘柄Aに47％、銘柄Bに53％投資するポートフォリオだったので、最適保有比率は、<span class="math inline">(w_F,w_A,w_B)\approx(0.29,0.33,0.38)</span>と書き換えられる。</p>
</section>
</section>
<section id="トービンの分離定理" class="level3">
<h3 class="anchored" data-anchor-id="トービンの分離定理">トービンの分離定理</h3>
<p>安全資産が投資可能な場合の最適ポートフォリオ問題を考える。</p>
<ol type="1">
<li>接点ポートフォリオを求め、リスク資産同士の相対的な保有比率を求める。</li>
<li>投資家ごとのリスク回避度に応じて安全資産と接点ポートフォリオの最適保有比率の決定</li>
</ol>
<p>1は各投資家で共通している。 いったん接点ポートフォリオを求めてしまえば、他の投資家はその情報を用いて2を考えればよい。</p>
<p>最適ポートフォリオ問題を2段階に分離できるという命題は、<strong>トービンの分離定理</strong>(又は二基金文理定理)と呼ばれている。</p>
</section>
</section>
<section id="capm" class="level2">
<h2 class="anchored" data-anchor-id="capm">CAPM</h2>
<p>ここでは，資産価格モデルの1つである資本資産価格モデル(Capital Asset Pricing Model)について議論する。まずは各投資家の最適ポートフォリオ問題を所与として、金融市場全体の均衡に関して議論する。</p>
<section id="仮定の確認" class="level3">
<h3 class="anchored" data-anchor-id="仮定の確認">仮定の確認</h3>
<ul>
<li><strong>選好</strong> : 全ての投資家はポートフォリオを期待値と標準偏差の基準で評価する</li>
<li><strong>取引コスト</strong> : 取引に際して手数料や税金が存在せず、空売りが自由に可能</li>
<li><strong>流動性</strong> : どれだけ売買しても証券の価格は変化しない</li>
<li><strong>情報集合</strong> : 全ての投資家は同じ情報を共有している</li>
</ul>
<p>上記の仮定を満たす金融市場のことを、一般に<strong>完全資本市場</strong>(完全市場: perfect market)と呼ぶ。 これは「取引を行う上で完全に摩擦のない市場」というものであり，理論上の設定である。</p>
<p>厳密にいうと、上記の仮定のうち<strong>いずれも現実には成立しない</strong>。 しかし、単純で分析が容易なモデルから出発し、その含意が仮定にどう依存するか議論を深めていくというのが経済理論の標準的なアプローチである。 実際、以降で導出するCAPMに関してこれらの仮定を緩めた理論が数多く提唱されている。</p>
</section>
<section id="capmの第一命題" class="level3">
<h3 class="anchored" data-anchor-id="capmの第一命題">CAPMの第一命題</h3>
<p>以上の仮定を受け入れると安全資産が投資可能なとき，全ての投資家の最適ポートフォリオ問題に対してトービンの分離定理を応用することができる。 全ての投資家は安全資産と接点ポートフォリオに投資し、危険資産に限定すれば同質的なポートフォリオを保有する。 金融市場全体の均衡を議論するうえで、市場にその資産が供給されている以上、誰かがその最適ポートフォリオの一部として保有しているという、需要と供給の一致がポイントである。</p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
例
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>市場に参加している投資家3名</li>
<li>市場に供給されている危険資産が銘柄XとYだけ</li>
<li>時価総額は<span class="math inline">X</span>が800億円、<span class="math inline">Y</span>が200億円　</li>
</ul>
<p>この市場には合計1000億円の危険資産が存在するとする。 全ての投資家が保有するリスク資産の合計額も1000億円に一致するはず。 リスク資産に限定すれば，全ての(合理的な)投資家は接点ポートフォリオと同じ比率でリスク資産を保有しているので，銘柄XとYの保有比率は時価総額と同じ比率8:2になっていなければならない。</p>
<table class="table">
<thead>
<tr class="header">
<th></th>
<th style="text-align: center;">銘柄<span class="math inline">X</span></th>
<th style="text-align: center;">銘柄<span class="math inline">Y</span></th>
<th style="text-align: center;">合計</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td></td>
<td style="text-align: center;"><span class="math inline">w_X=0.8</span></td>
<td style="text-align: center;"><span class="math inline">w_Y=0.2</span></td>
<td style="text-align: center;"><span class="math inline">w_X+w_Y=1</span></td>
</tr>
<tr class="even">
<td>投資家A</td>
<td style="text-align: center;">480</td>
<td style="text-align: center;">120</td>
<td style="text-align: center;">600</td>
</tr>
<tr class="odd">
<td>投資家B</td>
<td style="text-align: center;">240</td>
<td style="text-align: center;">60</td>
<td style="text-align: center;">300</td>
</tr>
<tr class="even">
<td>投資家C</td>
<td style="text-align: center;">80</td>
<td style="text-align: center;">20</td>
<td style="text-align: center;">100</td>
</tr>
<tr class="odd">
<td>合計</td>
<td style="text-align: center;">800</td>
<td style="text-align: center;">200</td>
<td style="text-align: center;">1000</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>以上の議論をよりフォーマルに述べるために、市場ポートフォリオを導入する。</p>
<div class="callout-important callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
市場ポートフォリオ
</div>
</div>
<div class="callout-body-container callout-body">
<p>市場ポートフォリオ (market portfolio)とは，市場に存在する全ての危険資産を時価総額比率で保有したポートフォリオをいう。厳密には，リスク資産には株式や債券に代表される金融資産の他、不動産や貴金属などの実物資産も含まれるが、実用上はTOPIXやS&amp;P500といった株価指数と同一視されることが多い。</p>
</div>
</div>
<div class="callout-important callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
CAPMの第一命題
</div>
</div>
<div class="callout-body-container callout-body">
<p>市場ポートフォリオは接点ポートフォリオと一致し、効率的フロンティア(資本市場線)上に位置する。</p>
</div>
</div>
<p>投資家は市場ポートフォリオに投資するとき、<span class="math inline">\sigma_M</span>のリスクを背負う見返りとして<span class="math inline">R_F</span>に加えて<span class="math inline">\mu_M-R_F</span>だけ追加的な報酬を期待する。 この追加的な報酬を<strong>市場リスクプレミアム</strong>(market risk premium)という。したがってこの命題の下では、資本市場線を市場リスクプレミアム<span class="math inline">(\mu_M-R_F</span>)を利用して、以下のように表せる。</p>
<p><span class="math display">
\mu_P = R_F + \frac{\mu_M - R_F}{\sigma_M} \sigma_P
</span></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/KM_fig_2-13.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">CAPM</figcaption><p></p>
</figure>
</div>
<p>今までのパラメータをそのまま用いる。 接点ポートフォリオの保有比率は概ね47%を銘柄Aに、 53%を銘柄Bに投資するポートフォリオになった。CAPMの第一命題によると、この市場における銘柄AとBの時価総額比率は約0.47対0.53になっていなければならない。 この命題によると、各銘柄の期待リターンや分散から接点ポートフォリオを計算する必要はなく、単に時価総額加重で市場ポートフォリオを保有すればよい。</p>
<ul>
<li><strong>パッシブ運用：</strong>幅広い銘柄に分散投資し、市場平均と同じようなパフォーマンスを目指す運用手法</li>
<li><strong>アクティブ運用：</strong>市場平均を上回るパフォーマンスを目指し、投資銘柄を絞ったり、投資比率を工夫したりする運用方法</li>
</ul>
<p>任意のポートフォリオの収益性を測る指標として、<strong>シャープ・レシオ</strong>が提唱されている。シャープ・レシオは追加的なリスク・テイクによってどれだけリスクプレミアムを改善できるのかを表す指標。CAPMの第一命題によると、市場ポートフォリオはシャープ・レシオを最大化するという意味で最も効率的なポートフォリオであり、資本市場線の傾き<span class="math inline">\frac{\mu_M - R_P}{\sigma_M}</span>は市場ポートフォリオのシャープ・レシオと一致する。</p>
<p><span class="math display">
\frac{\mu_P-R_F}{\sigma_P}
</span></p>
</section>
<section id="capmの第二命題" class="level3">
<h3 class="anchored" data-anchor-id="capmの第二命題">CAPMの第二命題</h3>
<p>第二命題は個々の資産のリスクとリターンのトレードオフを数式で表現したもの。 ある証券に投資するときのリスクと、その証券に投資するときの期待リターンとの関係を知ることができるようになる。各投資家が証券<span class="math inline">i</span>を追加的に保有する際、重要となるのは市場ポートフォリオとの相関。分散が大きい資産であっても、市場ポートフォリオと負に相関していれば、その資産を追加的に保有することでポートフォリオ全体のリスクは低減される。CAPMの第二命題は、この相関を以下の<strong>マーケット・ベータ</strong>として定量化する。 ※<span class="math inline">R_i</span>は証券<span class="math inline">i</span>のリターン、<span class="math inline">R_M</span>は市場ポートフォリオのリターン</p>
<p>この<span class="math inline">\beta_i</span>は市場ポートフォリオのリスクを1としてベンチマーク化し、その証券のリスクがベンチマークの1を上回るか下回るかを測るもの。<span class="math inline">\beta_i</span>が大きいほど証券<span class="math inline">i</span>は投資家にとってリスクが大きいことを意味する。証券iのリスクはその証券のリターンの標準偏差ではなく、この<span class="math inline">\beta_i</span>によって測られる。 <span class="math display">
\beta_i = \frac{\mathbb{Cov}[R_i, R_M]}{\mathbb{Var}[R_M]}
</span></p>
<p>金融市場全体が均衡しているには，リスクの高い証券はその分だけ期待リターンも高くなければならない。 <span class="math inline">\beta_i</span>が低いにもかかわらず期待リターンが高い証券があるなら、投資家は市場ポートフォリオから離れてその証券をさらに買い増しするインセンティブを持つ。 その結果、市場価格が上がり、期待リターンが下がるため、<span class="math inline">\beta_i</span>に応じた期待リターンが均衡で実現される。 CAPMの第二命題はこの均衡におけるリスクとリターンのトレードオフの関係を記述した式である。</p>
<p>これまでは市場リスクプレミアムを<span class="math inline">\mu_M - R_F</span>と表記していたが、以後ではより一般的な<span class="math inline">\mathbb{E}[R_M] - R_F</span>と表記する。</p>
<div class="callout-important callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
CAPMの第二命題
</div>
</div>
<div class="callout-body-container callout-body">
<p>各証券のリスクプレミアムは、その証券のマーケット・ベータに比例する。 この式は、証券<span class="math inline">i</span>のリスクプレミアム<span class="math inline">\mathbb{E}[R_i]-R_F</span>を、<span class="math inline">\beta_i</span>と市場リスクプレミアム<span class="math inline">\mathbb{E}[R_M]-R_F</span>に分解している。</p>
</div>
</div>
<p>第二項の<span class="math inline">\mathbb{E}[R_M]-R_F</span>は個々の証券には依存しない定数である。</p>
<p><span class="math display">
\begin{aligned}
\mathbb{E}[R_i]-R_F = \beta_i (\mathbb{E}[R_M] - R_F)\\
\text{ただし、 } \beta = \frac{Cov[R_i,R_M]}{Var[R_M]}
\end{aligned}
</span></p>
<p>通常、市場リスクプレミアムは正の値をとるので、CAPMの第二命題によると、個々の証券のリスクプレミアムは<span class="math inline">\beta_i</span>に関して線形に増加する。 <span class="math inline">\beta_i</span>はあくまで市場ポートフォリオとの相関でリスクを定量化しているのがポイント。 いくら個々の証券のリスクが大きくても、それが市場ポートフォリオと相関しない固有リスクであれば、リスクプレミアムには反映されない。 期待値をとる前の<span class="math inline">R_i</span>を分解して確認する。</p>
<p><span class="math display">
R_i = R_F + \beta_i (R_M - R_F) + \varepsilon_i
</span></p>
<p>ここで<span class="math inline">\varepsilon_i</span>は期待値ゼロで<span class="math inline">R_M</span>と相関しない誤差項である。</p>
<p><span class="math display">
\mathbb{E}[\varepsilon_i] = 0, \qquad \mathbb{Cov}[\varepsilon_i, R_M] = 0
</span></p>
<p><span class="math display">
\begin{aligned}
Var[R_i] &amp;= \mathbb{Var}[\beta_i R_M + \varepsilon_i]\\
&amp; = \beta_i^2 \mathbb{Var}[R_M] + \mathbb{Var}[\varepsilon_i] + \underbrace{\mathbb{Cov}[\beta_i R_M, \varepsilon_i]}_{\tiny =0}\\
&amp; = \underbrace{\beta_i^2 \mathbb{Var}[R_M]}_{\tiny 市場ポートフォリオとの相関による寄与分} + \underbrace{\mathbb{Var}[\varepsilon_i]}_{\tiny 誤差項による寄与分}
\end{aligned}
</span></p>
<p><span class="math inline">R_i</span>の分散を計算すると、市場ポートフォリオとの相関による寄与分と誤差項による寄与分に分解できる。 誤差項の分散が大きければその分だけ<span class="math inline">R_i</span>の分散も大きくなるが、証券<span class="math inline">i</span>のリスクプレミアムは<span class="math inline">\mathbb{E}[R_M]-R_F</span>のままで変化はない。</p>
</section>
<section id="証券市場線" class="level3">
<h3 class="anchored" data-anchor-id="証券市場線">証券市場線</h3>
<p>安全資産と複数の危険資産が投資可能な場合、投資家の最適ポートフォリオは各人のリスク回避度に応じて図2.14の左図の資本市場線の1点となる。CAPMの第二命題が示唆するように、各証券のリスクとリターンとの関係は図2.14の右図になる。縦軸に各証券の期待リターン、横軸に各証券のリスクを表すマーケット・ベータをとると、CAPMが完全に成立する世界では全ての資産が一直線上に並ぶ。この直線を<strong>証券市場線</strong>(Securities Market Line; SML)と呼ぶ。 現実は、必ずしもCAPMの第二命題は成立しておらず、CAPMが予測するリターン(証券市場線)からの縦方向からの乖離(これを<strong>アルファ</strong>と呼ぶ)が見られる。</p>
<p>図2.14挿入</p>
<p>定義通り<span class="math inline">\beta</span>を計算すると銘柄Aは約<span class="math inline">0.63</span>，銘柄Bは約<span class="math inline">1.33</span>となる。 両者の期待リターン、および<span class="math inline">\beta</span>を図示すると証券市場線に乗っており、この仮想的な市場ではCAPMが成立していることがわかる。 CAPMはアクティブ運用の賛同者から激しい批判を浴びてきたが、歴史的にみるとパッシブ運用を採用する機関投資家は増え続けており、ファイナンス理論及び投資実務の双方に多大な影響を与えてきたと言って過言ではない。</p>
</section>
<section id="n資産が投資可能な場合への拡張" class="level3">
<h3 class="anchored" data-anchor-id="n資産が投資可能な場合への拡張">N資産が投資可能な場合への拡張</h3>
<p>今までは，リスク資産が銘柄AとBの二つしかない場合を分析してきたが，現実は多くのリスク資産が存在し、海外株式や債券、REIT(不動産投資信託)といったその他の投資可能な金融資産を含めればその数は飛躍的に増加する。 本節での平均分散アプローチやCAPMは危険資産の数が任意の<span class="math inline">N</span>個であっても成立する。 ただしその場合は<strong>行列での表記</strong>が必須となる(第7章やサポートサイト4.5節参照)。</p>
<p>一般に，平均分散の意味で効率的なポートフォリオ(<strong>平均分散ポートフォリオ</strong>)を計算するには、目標期待リターンを所与として、それを実現するポートフォリオの中でリスクを最小化するものを求める。 得られた期待リターンとリスクのペアを一点として、目標期待リターンを動かすとリスク・リターン平面上に双曲線が描ける。 この双曲線を<strong>平均分散フロンティア</strong>と呼び、効率的フロンティアはその上半分の領域である(確認済み)。</p>
<p>一般に投資可能な資産の数が増えると、平均分散フロンティアは左上に移動し、投資家はより望ましいポートフォリオが実現できるようになる。 リスク資産<span class="math inline">A</span>と<span class="math inline">B</span>に加えて<span class="math inline">C</span>が投資可能な状況を考えると投資可能な資産が増えたからと言って必ずしもその資産に投資する必要はない。<span class="math inline">w_C=0</span>とすれば、投資家は危険資産<span class="math inline">A</span>と<span class="math inline">B</span>のみに投資可能だった場合と同じ投資機会集合を実現できる。 新しい危険資産が既存資産の組み合わせによって完全に再現できるような極端な例を除けば分散投資のメリットが生じるため、投資家はより望ましいリスク・リターンのトレードオフを実現できる。</p>
<p>統計学における分散の定義は，<span class="math inline">N</span>個の確率変数<span class="math inline">R_1,R_2,\cdots,R_N</span>の共分散行列<span class="math inline">\Sigma</span>の対角成分の和である。 <span class="math display">
\begin{align*}
\sigma^2=\sum_{i=1}^N\sum_{j=1}^N\sigma_{ij}=\sum_{i=1}^N\sigma_{ii}
\end{align*}
</span> ここで，<span class="math inline">\sigma_{ij}</span>は<span class="math inline">R_i</span>と<span class="math inline">R_j</span>の共分散であり，<span class="math inline">\sigma_{ii}</span>は<span class="math inline">R_i</span>の分散である。 共分散行列<span class="math inline">\Sigma</span>は対称行列であり，対角成分は分散を表す。 また，<span class="math inline">R_i</span>と<span class="math inline">R_j</span>の共分散は<span class="math inline">\sigma_{ij}=\sigma_{ji}</span>である。 共分散行列の対角成分以外の成分は共分散を表す。 <span class="math display">
\begin{align*}
\Sigma=
\begin{bmatrix}
\sigma_{11} &amp; \sigma_{12} &amp; \cdots &amp; \sigma_{1N} \\
\sigma_{21} &amp; \sigma_{22} &amp; \cdots &amp; \sigma_{2N} \\
\vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
\sigma_{N1} &amp; \sigma_{N2} &amp; \cdots &amp; \sigma_{NN} \\
\end{bmatrix}
\end{align*}
</span></p>
<p>上のは，<span class="math inline">N</span>個の確率変数の共分散行列の定義である。Copilotで作成しました。</p>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>